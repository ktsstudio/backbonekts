/*! 
* backbonekts - v0.1.0 - 2015-08-17
* http://gitlab.ktsstudio.ru/kts-libs/backbonekts
* Copyright (c) 2015 Grigory Ozhegov
* Licensed MIT 
*/

!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["backbone","underscore","notific","jquery"],b):"object"==typeof a?b.exports=b():a.BackboneKTS=b()}("object"==typeof exports&&exports||this,function(a,b,c,d){var e={};return e.Collection=a.Collection.extend({totalCount:0,pageCount:0,offset:0,pageSize:10,getBeginPagination:function(a){var b=a/this.pageSize-3;return 0>b&&(b=0),b},getEndPagination:function(a){var b=a/this.pageSize+3;return b>this.pageCount&&(b=this.pageCount),b},parse:function(a){return this.totalCount=a.data.count,this.pageCount=parseInt(this.totalCount/this.pageSize,10)+(this.totalCount%this.pageSize>0?1:0),a.data.items}}),e.Config={apiURL:!1,staticPrefix:!1,mediaPrefix:!1,apiVersion:"1",getMethodUrl:function(a,b){var c=this.apiURL+a+"?v="+this.apiVersion;if("object"==typeof b)for(var d in b)void 0!==b[d]&&(c+="&"+d+"="+b[d]);return c},getStaticUrl:function(a){return this.staticPrefix+a},getMediaUrl:function(a){return this.mediaPrefix+a}},e.Model=a.Model.extend({parse:function(a,b){if(b.collection)return a;try{return a.data.items[0]}catch(c){return{}}},_backboneSync:function(c,e,f){var g={create:"POST",update:"POST",patch:"POST","delete":"POST",read:"GET"},h=g[c];b.defaults(f||(f={}),{emulateHTTP:a.emulateHTTP,emulateJSON:!a.emulateJSON});var i={type:h,dataType:"json"};if(f.url||(i.url=b.result(e,"url")||console.error("URL not defined")),null!==f.data||!e||"create"!==c&&"update"!==c&&"patch"!==c||(i.contentType="application/json",i.data=JSON.stringify(f.attrs||e.toJSON(f))),f.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=f.attrs||e.toJSON(f),"object"==typeof i.data&&(i.data=d.param(i.data))),f.emulateHTTP&&("PUT"===h||"DELETE"===h||"PATCH"===h)){i.type="POST",f.emulateJSON&&(i.data._method=h);var j=f.beforeSend;f.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",h),j?j.apply(this,arguments):void 0}}"GET"===i.type||f.emulateJSON||(i.processData=!1);var k=f.xhr=a.ajax(b.extend(i,f));return e.trigger("request",e,k,f),k},sync:function(){return this._backboneSync.apply(this,arguments)}}),e.Router=a.Router.extend({redirect:function(b){a.history.navigate("/"+b,!0)},_viewsInstance:{},views:{},_getViewByName:function(a){if("undefined"==typeof this._viewsInstance[a]){var b=this.views[a];if("undefined"==typeof b)return null;this._viewsInstance[a]=new b}return this._viewsInstance[a]}}),e.View=a.View.extend({el:"#content",actions:function(){return{}},redirect:function(b){a.history.navigate("/"+b,!0)},render:function(){var a=arguments[0],b=null;"string"!=typeof a?(a="index",b=Array.prototype.slice.call(arguments,0)):b=Array.prototype.slice.call(arguments,1),"function"==typeof this.actions()[a]?this.actions()[a].apply(this,b):this._defaultAction()},serializeForm:function(a){var c={};return b.each(d(a).serializeArray(),function(a){var b=/\[(\w+)\]/gi,d=a.name.match(b);if(null===d)c[a.name]=a.value;else{var e=a.name.slice(0,a.name.search(b)),f=function(a,b,c){if(0===b.length)return isNaN(parseInt(c,10))||String(parseInt(c,10)).length!==c.length?isNaN(parseFloat(c))||String(parseFloat(c)).length!==c.length?c:parseFloat(c):parseInt(c,10);var d=b[0].slice(1,b[0].length-1);return isNaN(parseInt(d,10))||String(parseInt(d,10)).length!==d.length?void 0===a&&(a={}):void 0===a&&(a=[]),a[d]=f(a[d],b.slice(1),c),a};c[e]=f(c[e],d,a.value)}}),b.map(c,function(a,b){if("object"==typeof a){if(Array.isArray(a)){var d=[];for(var e in a)null!==a[e]&&void 0!==a[e]&&d.push(a[e]);a=d}c[b]=JSON.stringify(a)}}),c},_defaultAction:function(){this.$el.html(d("<h1/>",{html:"404"}))},_showSuccess:function(a,b){void 0===a&&(a="Выполнено"),void 0!==c?c.success({title:a,text:b,timeout:2e3}):console.log("Notific is undefined")},_showError:function(a,b){void 0===a&&(a="Ошибка"),void 0!==c?c.error({title:a,text:b,timeout:2e3}):console.log("Notific is undefined")}}),e});